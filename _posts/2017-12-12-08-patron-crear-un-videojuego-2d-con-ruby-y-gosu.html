---
layout: post
title: '08 Patrón - Crear un videojuego 2D con Ruby y Gosu'
date: '2017-12-12T11:21:00.000+01:00'
author: AITOR TOMAS PIN
tags: 
modified_time: '2018-01-03T16:02:52.312+01:00'
blogger_id: tag:blogger.com,1999:blog-611028137431305192.post-7429932805943983986
blogger_orig_url: http://compupiensaumh.blogspot.com/2017/12/08-patron-crear-un-videojuego-2d-con-ruby-y-gosu.html
---

En los posts anteriores hemos visto como crear un videojuego utilizando Ruby y la gema Gosu:<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/10/01-prerrequisitos-crear-un-videojuego-2d-con-ruby-y-gosu.html">01 Prerrequisitos</a>: Los prerrequisitos iniciales para poder comenzar a desarrollar nuestro juego con Ruby y Gosu.<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/10/02-hola-mundo-crear-un-videojuego-2d-con-ruby-y-gosu.html">02 Hola mundo</a>: Un pequeño programa Hola Mundo para introducirnos en el mundo de Gosu.<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/12/03-descripcion-crear-un-videojuego-2d-con-ruby-y-gosu.html">03 Descripción</a>: Descripción del ejercicio a realizar y especificaciones del juego.<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/11/04-medios-crear-un-videojuego-2d-con-ruby-y-gosu.html">04 Medios</a>: Definición de los medios gráficos y de audio a utilizar en el juego.<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/11/05-campanas-crear-un-videojuego-2d-con-ruby-y-gosu.html">05 Campanas</a>: Definición del objeto Campana.<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/11/06-puerta-crear-un-videojuego-2d-con-ruby-y-gosu.html">06 Puerta</a>: Definición del objeto Puerta.<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/12/07-teclado-crear-un-videojuego-2d-con-ruby-y-gosu.html">07 Teclado</a>: Creación de los eventos de teclado para interactuar con los objetos Campana.<br /><br />Una vez ya hemos mapeado las teclas numéricas del teclado con cada campana, podemos proceder a crear el patrón que abrirá la puerta y a añadir la lógica que comprobará si el patrón introducido es el correcto.<br /><br />Primero vamos a proceder a definir el patrón maestro mediante una constante PATTERN: <div class="codebox"><pre><br /><span>PATTERN = '333333351234444433355421'</span><br /></pre></div><br />Este patrón maestro <b>333333351234444433355421</b>, si le añadimos espacios en blanco para definir el tempo quedaría: <b>333 333 35123 444 4433 355421</b>. Si consideramos que:<br />- 1 = DO<br />- 2 = RE<br />- 3 = MI<br />- 4 = FA<br />- 5 = SOL<br /><br />Observamos que estas notas corresponden a las notas musicales del villancico "Navidad, Navidad".<br /><br />Es decir, necesitamos tocar con las campanas este villancico para poder salir de la mazmorra. Conforme avanzamos en el villancico, la puerta de la mazmorra debe ir cambiando de estado hasta que se encuentre completamente abierta. Si en algún momento cometemos un fallo, la puerta volverá a cerrarse completamente.<br /><br />Hemos añadido una nueva variable en el constructor de la clase Game llamada "@pattern_clicked" que nos va a almacenar el patrón clickeado al clickear en las campanas, es decir al presionar en las teclas numéricas del teclado: <div class="codebox"><pre><br /><span>def button_down(key)</span><br /><span>  @start_time = Gosu.milliseconds</span><br /><span>  @trigger = true</span><br /><span>  case key</span><br /><span>  when Gosu::Kb1</span><br /><span>    @bell_clicked = @bells[0]</span><br /><span>    @pattern_clicked += '1'</span><br /><span>  when Gosu::Kb2</span><br /><span>    @bell_clicked = @bells[1]</span><br /><span>    @pattern_clicked += '2'</span><br /><span>  when Gosu::Kb3</span><br /><span>    @bell_clicked = @bells[2]</span><br /><span>    @pattern_clicked += '3'</span><br /><span>  when Gosu::Kb4</span><br /><span>    @bell_clicked = @bells[3]</span><br /><span>    @pattern_clicked += '4'</span><br /><span>  when Gosu::Kb5</span><br /><span>    @bell_clicked = @bells[4]</span><br /><span>    @pattern_clicked += '5'</span><br /><span>  when Gosu::KbEscape</span><br /><span>    @trigger = false</span><br /><span>    close</span><br /><span>  else</span><br /><span>    @trigger = false</span><br /><span>    super</span><br /><span>  end</span><br /><span>end</span><br /></pre></div><br />Por otro lado, el método "update()" comprobará si vamos siguiendo correctamente el patrón comparándolo con el patrón maestro. En caso vayamos siguiendo correctamente el patrón maestro, se llamará al método "check_pattern()" de la clase Door para ir cambiando de estado de apertura la puerta hasta llegar a tener una puerta completamente abierta: <div class="codebox"><pre><br /><span>def update</span><br /><span>  if @trigger</span><br /><span>    if Gosu.milliseconds - @start_time < 100</span><br /><span>      @bell_clicked.click</span><br /><span>      if PATTERN.start_with? @pattern_clicked</span><br /><span>        if PATTERN == @pattern_clicked</span><br /><span>          @door.door_0_6</span><br /><span>        else</span><br /><span>          @door.check_pattern(PATTERN, @pattern_clicked)</span><br /><span>        end</span><br /><span>      else</span><br /><span>        @pattern_clicked = ''</span><br /><span>      end</span><br /><span>    else</span><br /><span>      @bells.each { |b| b.unclick }</span><br /><span>      @trigger = false</span><br /><span>    end</span><br /><span>  end</span><br /><span>end</span><br /></pre></div><br />