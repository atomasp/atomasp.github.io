---
layout: post
title: 07 Teclado - Crear un videojuego 2D con Ruby y Gosu
date: '2017-12-05T17:12:00.000+01:00'
author: AITOR TOMAS PIN
tags: 
modified_time: '2017-12-29T18:47:21.197+01:00'
blogger_id: tag:blogger.com,1999:blog-611028137431305192.post-8993949560481606402
blogger_orig_url: http://compupiensaumh.blogspot.com/2017/12/07-teclado-crear-un-videojuego-2d-con-ruby-y-gosu.html
---

En los posts anteriores hemos visto como crear un videojuego utilizando Ruby y la gema Gosu:<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/10/01-prerrequisitos-crear-un-videojuego-2d-con-ruby-y-gosu.html">01 Prerrequisitos</a>: Los prerrequisitos iniciales para poder comenzar a desarrollar nuestro juego con Ruby y Gosu.<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/10/02-hola-mundo-crear-un-videojuego-2d-con-ruby-y-gosu.html">02 Hola mundo</a>: Un pequeño programa Hola Mundo para introducirnos en el mundo de Gosu.<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/12/03-descripcion-crear-un-videojuego-2d-con-ruby-y-gosu.html">03 Descripción</a>: Descripción del ejercicio a realizar y especificaciones del juego.<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/11/04-medios-crear-un-videojuego-2d-con-ruby-y-gosu.html">04 Medios</a>: Definición de los medios gráficos y de audio a utilizar en el juego.<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/11/05-campanas-crear-un-videojuego-2d-con-ruby-y-gosu.html">05 Campanas</a>: Definición del objeto Campana.<br />- <a href="https://compupiensaumh.blogspot.com.es/2017/11/06-puerta-crear-un-videojuego-2d-con-ruby-y-gosu.html">06 Puerta</a>: Definición del objeto Puerta.<br /><br />Una vez hemos incluido las campanas y la puerta en la pantalla vamos a proceder a programar la interacción entre el teclado y las campanas. Como se ha comentado en las especificaciones, vamos a mapear las teclas numéricas del teclado del 1 al 5 con cada una de las campanas. El obejtivo es que al presionar una tecla numérica, la campana correspondiente se ilumine y emita la nota musical asociada. Así mismo, añadiremos la opción de que se salga del juego al presionar la tecla ESCAPE.<br /><br />Para ello, vamos a añadir a nuestra clase Game el método "button_down(key)". Este método lo define Gosu::Window por tanto vamos a proceder a sobrescribirlo: <div class="codebox"><pre><br /><span>def button_down(key)</span><br /><span>  @start_time = Gosu.milliseconds</span><br /><span>  @trigger = true</span><br /><span>  case key</span><br /><span>  when Gosu::Kb1</span><br /><span>    @bell_clicked = @bells[0]</span><br /><span>  when Gosu::Kb2</span><br /><span>    @bell_clicked = @bells[1]</span><br /><span>  when Gosu::Kb3</span><br /><span>    @bell_clicked = @bells[2]</span><br /><span>  when Gosu::Kb4</span><br /><span>    @bell_clicked = @bells[3]</span><br /><span>  when Gosu::Kb5</span><br /><span>    @bell_clicked = @bells[4]</span><br /><span>  when Gosu::KbEscape</span><br /><span>    @trigger = false</span><br /><span>    close</span><br /><span>  else</span><br /><span>    @trigger = false</span><br /><span>    super</span><br /><span>  end</span><br /><span>end</span><br /></pre></div><br />Observamos varias cosas interesantes. La primera es el uso de dos variables (las definiremos previamente en el constructor) "@trigger" y "@start_time", las cuales usaremos para decirle al método "update()" que se ha presionado una tecla y cuándo. Hay que recordar que el método "update()" se ejecuta 60 veces por segundo por defecto, así que básicamente lo que le decimos con estas variables es, ha habido un click en una tecla y acaba de ocurrir. La segunda es que dependiendo de la tecla numérica clickeada, vamos a escoger una campana (una nota musical). Finalmente, se observa como hemos incluido la opción de salir del juego al presionar ESCAPE.<br /><br />El método "update()" por tanto va a contener el siguiente código: <div class="codebox"><pre><br /><span>def update</span><br /><span>  if @trigger</span><br /><span>    if Gosu.milliseconds - @start_time < 100</span><br /><span>      @bell_clicked.click</span><br /><span>    else</span><br /><span>      @bells.each { |b| b.unclick }</span><br /><span>      @trigger = false</span><br /><span>    end</span><br /><span>  end</span><br /><span>end</span><br /></pre></div><br />Lo que hace el método "update()" es comprobar si ha habido un click en una tecla del teclado, y entonces realizar una acción durante los siguientes 100 milisegundos. Es decir, lo que hace es llamar al método "click()" de la campana correspondiente, el cual ejecuta el cambio a campana clickeada y reproduce la nota musical. A los 100ms ejecuta el método "unclick()" para todas las campanas para que vuelvan a su estado original (es una manera de evitar que si presionamos varias teclas a la vez, se quede alguna campana en estado click permanente). De esta manera conseguimos el efecto de click sobre nuestras campanas.<br /><br />En el siguiente video se muestra este efecto (importante tener el audio activado):<br /><br /><div class="separator" style="clear: both; text-align: center;"><object id="BLOG_video-c048e236cb296d25" class="BLOG_video_class" contentid="c048e236cb296d25" width="320" height="266" ></object></div><br />